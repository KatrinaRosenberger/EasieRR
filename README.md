# EasieRR
Data from Biopac must be exported from the Biopac software to a txt file. When loading the data, the user has the option whether to synchronise the data with video recording of the experiment. If no synchronisation is needed the program will open a loading screen (fig XX)
 
The “Set FS” window is for setting the sampling frequency. The “Set refractory time” determines how long after a peak no new peak will be detected. This corresponds to the absolute refractory period, the period where, no matter how strong a stimulus, no new heartbeat can be initiated. Pressing the “Load Biopak” button will open up a dialog box for choosing the Biopack file to be analysed. To maximize the compability of this software it is also possible to analyse data in the form of comma separated value (CSV) files, this is accomplished using the “Load CSV” button. When any of these two lading buttons are used the loading screen will close and the analysis will begin. The peak detection method being used is peak prominence: The height of the peak to be detected must be at least a certain value times the width of the peak at half the max height. This value can be set in the “Peak prominence” window. Before peak detection is being done the ECG signal is bandpass filtered. To change the lower- and higher cut-off frequency the user can change the value given in the “Low cutoff” and “High cutoff” window.
If synchronisation is needed an additional file is needed to establish a common point in time for the ECG data and video; A marker that can be seen on both data streams. This synchronisation is done by the mean of a Microsoft Excel file containing three columns: First column must contain the exact filename used for the txt file. Second column must contain the number of seconds from the beginning of the ECG data until the marker and the third column must contain the number of seconds from the beginning of the video until the marker seen on the video. Having these data in a separate Excel sheet enables the user to have all times for all files in a research project in one file. Our program will automatically look for the filename in the first column and create a timeline for the HRV data that starts at the beginning of the video, thereby making analysis in Observer much easier. Should Excel be set up to use comma as separator, column two and three must be in whole seconds and be formatted as “General”. By utilizing this synchronisation the ECG and thereby the HRV data will always be synchronized with the video. If something happens at 10 seconds on the ECG timeline, it corresponds to what happens at 10 after the beginning of the video.
The GUI first does a band pass filtering on the raw ECG data (4. Order 0 degree filtering with low and high cut-off frequency determined by the user), thereby removing high frequency peaks in the signal as well as removing any DC offset.
Peak detection for extraction of cycle times was done by using peak prominence: for a peak to be detected the height had to be at least a user-determined value of the width of the peak at half height. As ECG signal from free moving animals can differ from individual to individual, the GUI had two options for peak detection: Positive peaks and negative peaks. Traditionally positive peaks (the R peak) are used for HRV, but as long as the variability within the cycles of the heart rate is calculated, negative peaks are also valid measuring points for the RR intervals used in the HRV calculations
For visually examining the ECG data, the GUI has two interactive windows. The first window shows the band pass filtered ECG data as well as the high pass filtered ECG. The first is used for detection of peaks for establishing RR times, the second is displayed for visually examining the validity of the peak detection. To facilitate the detection of faulty RR interval detection the second window shows the corresponding RR interval values in milliseconds. The two zoomable windows displaying the ECG and RR interval plots are at all times synchronised. By examining only the bandpass filtered ECG the user will need to zoom in on individual cycles to detect faulty peak detections and thereby faulty RR intervals. By including a window displaying synchronised RR intervals faulty peak detection can be done without the need to zoom into individual cycles as the RR interval arising from faulty peak detection will differ significantly from the surrounding RR intervals. This will be easy reconcilable as a distinct peak in the RR interval plot. An absolute refractory time of 300 ms is built in the RR interval algorithm.
The workflow using the GUI consists of first detecting time ranges where the ECG data is good. The user has the option to always use the same time range (i.g. 10 or 20 seconds) as often used in previous studies (REF). if a fixed time range is used, the user sets a crosshair to mark the beginning of the time range he wants to use for further analysis. If the user wants to use time ranges of varying length, two time spots must be marked on the window showing the signal: The beginning and the end of the time range. The GUI will insert two vertical lines I the window displaying the tachogram, one at the start of the time range and one at the end. This way it is easy for the user to go through the entire signal and chose non-overlapping time ranges. 
If there is faulty RR interval detections in the time range chosen, there is the option to remove them. Some software chooses to interpolate the signal, but since this GUI uses only the intervals and not the absolute times for calculating the HRV parameters, the process of creating fake data by interpolating is not necessary and the faulty intervals are treated as outliers and erased from the dataset. The program allows for undoing an outlier. The last outlier marked and disposed of in the data, can be taken back into account during the HRV calculations
Another approach for ensuring correct RR interval determination is the possibility of manually moving individual peaks. If during the visual inspection it is observed that a wrong peak has been used to establish the RR interval, the user has the option to mark which peak is wrongly detected and then manually mark where the correct location of the peak should be. This change of location for a peak must be done within two periods of the signal: The user must mark the new location of the peak to the right of the previous peak detected and to the left of the following peak detected. Like in the outlier process the program also allows for undoing a move of a peak.
As soon as the user chooses a time range, all relevant HRV parameters are calculated (men heart rate, RMSSD, SD1, SD2, percentage of outliers, number of data points) and a Poincare plot is made. Using the Poincare plots makes it easy to detect outliers that might have been missed using the RR interval window and the ECG data. If faulty data is detected the user can remove outliers and recalculate.
When the user is satisfied with the current time window and the associated HRV parameters, he/she can save the data to a table. This table is formatted for maximum compatibility with Observer. This means each time window saved to the table results in two lines; The first line contain the start time (in seconds) and the value of all the HRV parameters as well as number of  peaks used for the calculations. The second line contains the stop time (in seconds) and the same values as the first line. This might seem reductant, but it is the easiest way to import the data into Observer.
This way the entire data from the individual experiment can be evaluated and when HRV parameters for all good time ranges has been calculated, the user can choose to save the set of parameters to a file. This name of this file automatically contains the name of the txt file created in Biopack. This way it will always be possible to go back and know which experiments and animal the HRV parameters comes from. Besides the above mentioned txt file used for further analysis, the program also saves a matlab file with the same name as the txt file. This mat file contains all relevant data for plotting the Poincare plot at a later point. The GUI contains a button for loading and plotting Poincare plots previously saved.
